<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Contract UI</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
</head>
<body>
    <h1>Transaction Contract</h1>

    <!-- Connect to MetaMask -->
    <br>

    <button onclick="accessToMetamask()">Connect Metamask</button> <br>
    
    <p id="accountArea"></p>
    
    <br>
    
    <button onclick="accessToContract()">Connect to Smart Contract</button> <br>
    
    <p id="contractArea"></p>
    
    <br>

    <!-- Add Funds -->
    <h2>Add Funds</h2>
    <input type="number" id="fundAmount" placeholder="Enter amount in Ether">
    <button id="addFunds">Add Funds</button>

    <!-- Check Balance -->
    <h2>Check Balance</h2>
    <input type="text" id="balanceAccount" placeholder="Enter account address">
    <button id="checkBalance">Check Balance</button>
    <p id="balance"></p>

    <!-- Withdraw -->
    <h2>Withdraw</h2>
    <input type="number" id="withdrawAmount" placeholder="Enter amount to withdraw">
    <button id="withdraw">Withdraw</button>

    <!-- List Scheduled Withdrawals -->
    <h2>List Scheduled Withdrawals</h2>
    <button id="listScheduledWithdrawals">List Scheduled Withdrawals</button>
    <div id="scheduledWithdrawalsList"></div>

    <!-- Schedule Withdrawal -->
    <h2>Schedule Withdrawal</h2>
    <input type="number" id="scheduleWithdrawAmount" placeholder="Enter amount in Ether">
    <input type="number" id="withdrawTimePeriod" placeholder="Time period in seconds">
    <button id="scheduleWithdraw">Schedule Withdrawal</button>

    <!-- Cancel Scheduled Withdrawal -->
    <h2>Cancel Scheduled Withdrawal</h2>
    <input type="number" id="cancelWithdrawIndex" placeholder="Enter index of withdrawal">
    <button id="cancelWithdraw">Cancel Scheduled Withdrawal</button>

    <!-- Execute Scheduled Withdrawal -->
    <h2>Execute Scheduled Withdrawal</h2>
    <input type="number" id="executeWithdrawIndex" placeholder="Enter index of withdrawal">
    <button id="executeWithdraw">Execute Scheduled Withdrawal</button>

    <!-- Instant Transfer -->
    <h2>Instant Transfer</h2>
    <input type="text" id="transferTo" placeholder="Recipient address">
    <input type="number" id="transferAmount" placeholder="Enter amount in Ether">
    <button id="instantTransfer">Transfer Now</button>

    <!-- List Scheduled Transfers -->
    <h2>List Scheduled Transfers</h2>
    <button id="listScheduledTransfers">List Scheduled Transfers</button>
    <div id="scheduledTransfersList"></div>

    <!-- Schedule Transfer -->
    <h2>Schedule Transfer</h2>
    <input type="text" id="scheduleTransferTo" placeholder="Recipient address">
    <input type="number" id="scheduleTransferAmount" placeholder="Enter amount in Ether">
    <input type="number" id="transferTimePeriod" placeholder="Time period in seconds">
    <button id="scheduleTransfer">Schedule Transfer</button>

    <!-- Cancel Scheduled Transfer -->
    <h2>Cancel Scheduled Transfer</h2>
    <input type="number" id="cancelTransferIndex" placeholder="Enter index of transfer">
    <button id="cancelTransfer">Cancel Scheduled Transfer</button>

    <!-- Execute Scheduled Transfer -->
    <h2>Execute Scheduled Transfer</h2>
    <input type="number" id="executeTransferIndex" placeholder="Enter index of transfer">
    <button id="executeTransfer">Execute Scheduled Transfer</button>

    <!-- Add Child Account -->
    <h2>Add Child Account</h2>
    <input type="text" id="childAddress" placeholder="Child account address">
    <button id="addChild">Add Child Account</button>

    <script>
        //1- connect metamask
        let account;
        const accessToMetamask = async () => {
            if(window.ethereum !== "undefined") {
                const accounts = await ethereum.request({ method:"eth_requestAccounts"});
                account = accounts[0];
                document.getElementById("accountArea").innerHTML = account;
            }

        }

        //2- connect to smart contract
        const accessToContract = async () => {
            const ABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_child",
				"type": "address"
			}
		],
		"name": "addChildAccount",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "addFunds",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_timePeriod",
				"type": "uint256"
			}
		],
		"name": "addScheduleWithdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "cancelScheduledTransfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "cancelScheduleWithdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "executeScheduledTransfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "executeScheduledWithdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "instantTransfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_timePeriod",
				"type": "uint256"
			}
		],
		"name": "scheduleTransfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "accounts",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "balance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "startTime",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "contractEndTime",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "parent",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "isChild",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_account",
				"type": "address"
			}
		],
		"name": "checkBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_child",
				"type": "address"
			}
		],
		"name": "checkTimeRemaining",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "scheduledTransfers",
		"outputs": [
			{
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "unlockTime",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "active",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "scheduledWithdrawals",
		"outputs": [
			{
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "unlockTime",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "active",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
            const Address = "0x55703d013d662925d7550f371d295B79E0bcCc5a";
            window.web3 = await new Web3(window.ethereum); //how to access to smart contract

            window.contract = await new window.web3.eth.Contract( ABI, Address); //how you create an instance of that contract by using the abi and address

            document.getElementById("contractArea").innerHTML = "connected to Transaction smart contract";
        }

        // Add Funds
        document.getElementById('addFunds').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const amount = document.getElementById('fundAmount').value;
            await contract.methods.addFunds(web3.utils.toWei(amount, "ether")).send({ from: accounts[0], value: web3.utils.toWei(amount, "ether") });
        };

        // Check Balance
        document.getElementById('checkBalance').onclick = async () => {
            const account = document.getElementById('balanceAccount').value;
            const balance = await contract.methods.checkBalance(account).call();
            document.getElementById('balance').innerText = `Balance: ${web3.utils.fromWei(balance, "ether")} Ether`;
        };

        // Withdraw
        document.getElementById('withdraw').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const amount = document.getElementById('withdrawAmount').value;
            await contract.methods.withdraw(web3.utils.toWei(amount, "ether")).send({ from: accounts[0] });
        };

        // List Scheduled Withdrawals
        document.getElementById('listScheduledWithdrawals').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const scheduledWithdrawals = await contract.methods.scheduledWithdrawals(accounts[0]).call();

            let output = "<ul>";
            for (let i = 0; i < scheduledWithdrawals.length; i++) {
                const withdrawal = scheduledWithdrawals[i];
                output += `<li>Index: ${i}, Amount: ${web3.utils.fromWei(withdrawal.amount, "ether")} Ether, Unlock Time: ${new Date(withdrawal.unlockTime * 1000).toLocaleString()}, Active: ${withdrawal.active}</li>`;
            }
            output += "</ul>";
            document.getElementById('scheduledWithdrawalsList').innerHTML = output;
        };

        // Execute Scheduled Withdrawal
        document.getElementById('executeWithdraw').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const index = document.getElementById('executeWithdrawIndex').value;
            await contract.methods.executeScheduledWithdraw(index).send({ from: accounts[0] });
        };

        // Schedule Withdrawal
        document.getElementById('scheduleWithdraw').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const amount = document.getElementById('scheduleWithdrawAmount').value;
            const timePeriod = document.getElementById('withdrawTimePeriod').value;
            await contract.methods.addScheduleWithdraw(web3.utils.toWei(amount, "ether"), timePeriod).send({ from: accounts[0] });
        };

        // Cancel Scheduled Withdrawal
        document.getElementById('cancelWithdraw').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const index = document.getElementById('cancelWithdrawIndex').value;
            await contract.methods.cancelScheduleWithdraw(index).send({ from: accounts[0] });
        };

        // Execute Scheduled Withdrawal
        document.getElementById('executeWithdraw').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const index = document.getElementById('executeWithdrawIndex').value;
            await contract.methods.executeScheduledWithdraw(index).send({ from: accounts[0] });
        };

        // Instant Transfer
        document.getElementById('instantTransfer').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const to = document.getElementById('transferTo').value;
            const amount = document.getElementById('transferAmount').value;
            await contract.methods.instantTransfer(to, web3.utils.toWei(amount, "ether")).send({ from: accounts[0] });
        };

        // Schedule Transfer
        document.getElementById('scheduleTransfer').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const to = document.getElementById('scheduleTransferTo').value;
            const amount = document.getElementById('scheduleTransferAmount').value;
            const timePeriod = document.getElementById('transferTimePeriod').value;
            await contract.methods.scheduleTransfer(to, web3.utils.toWei(amount, "ether"), timePeriod).send({ from: accounts[0] });
        };

        // List Scheduled Transfers
        document.getElementById('listScheduledTransfers').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const scheduledTransfers = await contract.methods.scheduledTransfers(accounts[0]).call();

            let output = "<ul>";
            for (let i = 0; i < scheduledTransfers.length; i++) {
                const transfer = scheduledTransfers[i];
                output += `<li>Index: ${i}, To: ${transfer.recipient}, Amount: ${web3.utils.fromWei(transfer.amount, "ether")} Ether, Unlock Time: ${new Date(transfer.unlockTime * 1000).toLocaleString()}, Active: ${transfer.active}</li>`;
            }
            output += "</ul>";
            document.getElementById('scheduledTransfersList').innerHTML = output;
        };

        // Cancel Scheduled Transfer
        document.getElementById('cancelTransfer').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const index = document.getElementById('cancelTransferIndex').value;
            await contract.methods.cancelScheduledTransfer(index).send({ from: accounts[0] });
        };

        // Execute Scheduled Transfer
        document.getElementById('executeTransfer').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const index = document.getElementById('executeTransferIndex').value;
            await contract.methods.executeScheduledTransfer(index).send({ from: accounts[0] });
        };

        // Add Child Account
        document.getElementById('addChild').onclick = async () => {
            const accounts = await web3.eth.getAccounts();
            const child = document.getElementById('childAddress').value;
            await contract.methods.addChildAccount(child).send({ from: accounts[0] });
        };
    </script>
</body>
</html>
