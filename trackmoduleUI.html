<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Trackmodule 2.0</title>
	<script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
	<link rel="stylesheet" href="style.css">
	<style>
/* body {
        font-family: 'Arial', sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f0f2f5;
    } */

	.container-transaction {
        display: block;
        position: absolute;
		margin-top: 100px;
		top: 50%;
		left: 30%;
		right: 30%;

    }

    .section {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px 30px 20px 30px;
        transition: all 0.3s ease;
		margin-bottom: 20px;
    }

    .section:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .section h2 {
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
        margin-top: 0;
        margin-bottom: 20px;
    }

    .section input,
    .section button {
        width: 100%;
        margin-bottom: 10px;
    }

    .section button {
        margin-top: 10px;
    }

	.section:hover {
        transform: translateY(-5px);
    }

	.btn-primary { background-color: #3498db; }
.btn-danger { background-color: #e74c3c; }
.btn-success { background-color: #2ecc71; }
.btn-warning { background-color: #f39c12; }
.btn-info { background-color: #3498db; }

.btn-primary:hover { background-color: #2980b9; }
.btn-danger:hover { background-color: #c0392b; }
.btn-success:hover { background-color: #27ae60; }
.btn-warning:hover { background-color: #e67e22; }
.btn-info:hover { background-color: #2980b9; }

	h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 30px;
    }

    h2 {
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
    }

	h2 {
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
        margin-top: 0;
    }

    input[type="number"],
    input[type="text"],
    input[type="datetime-local"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 14px;
    }


    button {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.1s;
        font-size: 14px;
        width: 100%;
    }

    button:hover {
        background-color: #2980b9;
    }

	button:active {
        transform: scale(0.98);
    }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

		.modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 90%;
    max-width: 800px;
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    max-height: 80vh;
    overflow-y: auto;
}

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

		.metamask-container {
    text-align: center;
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 8px;
    max-width: 300px;
    margin: 0 auto;
  }

  .metamask-title {
    color: #343a40;
    font-size: 24px;
    margin-bottom: 20px;
  }

  .metamask-button {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f6851b;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .metamask-button:hover {
    background-color: #e2761b;
  }

  .metamask-logo {
    width: 24px;
    height: 24px;
    margin-right: 10px;
  }


  #scheduledTransfersContent table {
    width: 100%;
    border-collapse: collapse;
}

#scheduledTransfersContent th, #scheduledTransfersContent td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}

#scheduledTransfersContent th {
    background-color: #f2f2f2;
}
	</style>
</head>

<body>
    <header class="site-navbar" role="banner">

        <div class="container">
          <div class="row align-items-center">
              
            <div class="col-11 col-xl-2">
              <h1 class="mb-0 site-logo"><a href="main.html" class="text-white mb-0"><b style="color: yellow;">Bee</b>Wallet</a></h1>
            </div>
            <div class="col-12 col-md-10 d-none d-xl-block">
              <nav class="site-navigation position-relative text-right" role="navigation">
  
                <ul class="site-menu js-clone-nav mr-auto d-none d-lg-block">
                  <li class="active"><a href="main.html"><span>Home</span></a></li>
                  <li><a href="regEdit.html"><span>Account Info</span></a></li>
                  <li class="has-children">
                    <a href="DepositAndWithdraw.html"><span>Deposit And Withdrawals</span></a>
                    <ul class="dropdown arrow-top">
                      <li><a href="#">Deposit</a></li>
                      <li class="has-children">
                        <a href="#">Withdrawals</a>
                        <ul class="dropdown">
                          <li><a href="#">List Scheduled Withdrawals</a></li>
                          <li><a href="#">Schedule Withdrawals</a></li>
                          <li><a href="#">Execute Withdrawals</a></li>
                          <li><a href="#">Cancel Withdrawals</a></li>
                          <li><a href="#">Schedule Withdrawals For Child</a></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li><a href="trackmoduleUI.html"><span>Transaction</span></a></li>
                  <li><a href="about.html"><span>Interest</span></a></li>
                  <li><a href="blog.html"><span>Reward</span></a></li>
                </ul>
                <input type="text" name="address" id="navAddress" disabled>
              </nav>
            </div>
  
  
            <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-white"><span class="icon-menu h3"></span></a></div>
  
            </div>
  
          </div>
        </div>
        
      </header>

    <div id="statusModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p id="modalContent"></p>
        </div>
    </div>

	<div id="transferHistoryModal" class="modal">
		<div class="modal-content">
			<span class="close">&times;</span>
			<div id="transferHistoryContent"></div>
		</div>
	</div>

	<div id="scheduledTransfersModal" class="modal">
		<div class="modal-content">
			<span class="close">&times;</span>
			<div id="scheduledTransfersContent"></div>
		</div>
	</div>

	<div id="transferHistoryModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="transferHistoryContent"></div>
    </div>
</div>

<div id="transferDetailsModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="transferDetailsContent"></div>
    </div>
</div>

<div id="totalAmountModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="totalAmountContent"></div>
    </div>
</div>

	<!-- <div class="metamask-container">
		<h2 class="metamask-title">Connect to MetaMask</h2>
		<button class="metamask-button" onclick="connectMetaMask()">
		  <img src="https://cdn.iconscout.com/icon/free/png-256/metamask-2728406-2261817.png" alt="MetaMask Logo" class="metamask-logo">
		  Connect MetaMask
		</button>
	  </div> -->

	<!-- <h2>Contract Control</h2>
	<button onclick="pauseContract()">Pause Contract</button>
	<button onclick="unpauseContract()">Unpause Contract</button> -->

	<!-- <div class="section">
		<h2>Add Funds</h2>
		<input type="number" id="addFundsAmount" placeholder="Amount in Ether">
		<button onclick="addFunds()">Add Funds</button>
	</div> -->

	<div class="container-transaction">
		<!-- <div class="section">
			<h2>Check Balance</h2>
			<input type="text" id="checkBalanceAddress" placeholder="Address">
			<button onclick="checkBalance()">Check Balance</button>
		</div> -->
	
		<div class="section">
			<h2>Instant Transfer</h2>
			<input type="text" id="instantTransferTo" placeholder="To Address">
			<input type="number" id="instantTransferAmount" placeholder="Amount in Ether">
			<button onclick="instantTransfer()">Transfer</button>
		</div>

		<div class="section">
			<h2>Scheduled Transfers</h2>
			<button onclick="getAllScheduledTransfers()" class="btn-primary">Get All Scheduled Transfers</button>
		</div>
	
		<div class="section">
			<h2>Cancel Transfer</h2>
			<input type="number" id="cancelTransferIndex" placeholder="Transfer Index">
			<button onclick="cancelScheduledTransfer()" class="btn-danger">Cancel Transfer</button>
		</div>
	
		<div class="section">
			<h2>Schedule Auto Execution</h2>
			<input type="text" id="autoScheduleTransferTo" placeholder="To Address">
			<input type="number" id="autoScheduleTransferAmount" placeholder="Amount in Ether">
			<input type="datetime-local" id="autoScheduleTransferUnlockTime">
			<button onclick="scheduleAutoExecution()" class="btn-success">Schedule Auto Execution</button>
		</div>
	
		<div class="section">
			<h2>Auto Scheduled Transfers</h2>
			<button onclick="executeAutoScheduledTransfers()" class="btn-warning">Execute Auto Scheduled Transfers</button>
		</div>
	
		<div class="section">
			<h2>Transfer History</h2>
			<input type="text" id="transferHistoryUser1" placeholder="User 1 Address">
			<input type="text" id="transferHistoryUser2" placeholder="User 2 Address">
			<button onclick="getTransferHistory()" class="btn-info">Get History</button>
		</div>
	
		<div class="section">
			<h2>All Transfer History</h2>
			<input type="text" id="allTransferHistoryUser" placeholder="User Address">
			<button onclick="getAllTransferHistory()" class="btn-info">Get All History</button>
		</div>
	
		<div class="section">
			<h2>Transfer Details</h2>
			<input type="text" id="transferDetailsUser" placeholder="User Address">
			<input type="number" id="transferDetailsIndex" placeholder="Transfer Index">
			<button onclick="getTransferDetails()" class="btn-info">Get Details</button>
		</div>
	
		<div class="section">
			<h2>Total Transaction Amount</h2>
			<input type="text" id="totalAmountSender" placeholder="Sender Address">
			<input type="text" id="totalAmountReceiver" placeholder="Receiver Address">
			<button onclick="getTotalTransactionAmount()" class="btn-info">Get Total Amount</button>
		</div>
        </div>

	<script>
		let web3;
		let contract;
		const contractAddress = "0x2adb2a881893917147c89bCBFAE4a262502F48Cb";
		const contractABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "FundsAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [],
		"name": "Paused",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "ScheduledTransferCancelled",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "unlockTime",
				"type": "uint256"
			}
		],
		"name": "ScheduledTransferCreated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "ScheduledTransferExecuted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "TransferExecuted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [],
		"name": "Unpaused",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "accounts",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "balance",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "addFunds",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "cancelScheduledTransfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_account",
				"type": "address"
			}
		],
		"name": "checkBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "executeAutoScheduledTransfers",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getAllScheduledTransfers",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "receivers",
				"type": "address[]"
			},
			{
				"internalType": "uint256[]",
				"name": "amounts",
				"type": "uint256[]"
			},
			{
				"internalType": "uint256[]",
				"name": "unlockTimes",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "activeStatuses",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_user",
				"type": "address"
			}
		],
		"name": "getAllTransferHistory",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "sender",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "receiver",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "timestamp",
						"type": "uint256"
					}
				],
				"internalType": "struct Transaction.TransferRecord[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_sender",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_receiver",
				"type": "address"
			}
		],
		"name": "getTotalTransactionAmount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_user",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "getTransferDetails",
		"outputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_user1",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_user2",
				"type": "address"
			}
		],
		"name": "getTransferHistory",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "sender",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "receiver",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "timestamp",
						"type": "uint256"
					}
				],
				"internalType": "struct Transaction.TransferRecord[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "instantTransfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "pause",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "paused",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_unlockTime",
				"type": "uint256"
			}
		],
		"name": "scheduleAutoExecution",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "scheduledTransfers",
		"outputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "unlockTime",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "active",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "transferHistory",
		"outputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "unpause",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];

		async function connectMetaMask() {
			if (typeof window.ethereum !== 'undefined') {
				try {
					await window.ethereum.request({ method: 'eth_requestAccounts' });
					web3 = new Web3(window.ethereum);
					contract = new web3.eth.Contract(contractABI, contractAddress);
					document.getElementById('status').innerText = 'Connected to MetaMask';
				} catch (error) {
					console.error(error);
					document.getElementById('status').innerText = 'Failed to connect to MetaMask';
				}
			} else {
				document.getElementById('status').innerText = 'MetaMask not detected';
			}
		}


		function showStatus(message) {
            document.getElementById('modalContent').innerHTML = message;
            document.getElementById('statusModal').style.display = 'block';
        }

		document.querySelectorAll('.close').forEach(closeBtn => {
    closeBtn.onclick = function() {
        this.closest('.modal').style.display = 'none';
    }
});

// Close the modals when clicking outside of them
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}

		async function addFunds() {
			const amount = document.getElementById('addFundsAmount').value;
			const accounts = await web3.eth.getAccounts();
			try {
				await contract.methods.addFunds(web3.utils.toWei(amount, 'ether')).send({ from: accounts[0], value: web3.utils.toWei(amount, 'ether') });
				document.getElementById('status').innerText = 'Funds added successfully';
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to add funds';
			}
		}

		async function checkBalance() {
			const address = document.getElementById('checkBalanceAddress').value;
			try {
				const balance = await contract.methods.checkBalance(address).call();
				document.getElementById('status').innerText = `Balance: ${web3.utils.fromWei(balance, 'ether')} ETH`;
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to check balance';
			}
		}

		async function instantTransfer() {
			const to = document.getElementById('instantTransferTo').value;
			const amount = document.getElementById('instantTransferAmount').value;
			const accounts = await web3.eth.getAccounts();
			try {
				await contract.methods.instantTransfer(to, web3.utils.toWei(amount, 'ether')).send({ from: accounts[0] });
				document.getElementById('status').innerText = 'Transfer successful';
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Transfer failed';
			}
		}

		// async function scheduleTransfer() {
		// 	const to = document.getElementById('scheduleTransferTo').value;
		// 	const amount = document.getElementById('scheduleTransferAmount').value;
		// 	const period = document.getElementById('scheduleTransferPeriod').value;
		// 	const accounts = await web3.eth.getAccounts();

		// 	if (isNaN(amount) || isNaN(period) || parseFloat(amount) <= 0 || parseInt(period) <= 0) {
		// 		document.getElementById('status').innerText = 'Invalid amount or period';
		// 		return;
		// 	}

		// 	try {
		// 		await contract.methods.addScheduledTransfer(to, web3.utils.toWei(amount, 'ether'), period).send({ from: accounts[0] });
		// 		document.getElementById('status').innerText = 'Transfer scheduled';
		// 	} catch (error) {
		// 		console.error(error);
		// 		document.getElementById('status').innerText = 'Failed to schedule transfer: ' + error.message;
		// 	}
		// }

		// async function executeScheduledTransfer() {
		// 	const index = document.getElementById('executeTransferIndex').value;
		// 	const accounts = await web3.eth.getAccounts();

		// 	if (isNaN(index) || parseInt(index) < 0) {
		// 		document.getElementById('status').innerText = 'Invalid index';
		// 		return;
		// 	}

		// 	try {
		// 		const receipt = await contract.methods.executeScheduledTransfer(index).send({ from: accounts[0] });
		// 		const gasUsed = receipt.gasUsed;
		// 		document.getElementById('status').innerText = `Scheduled transfer executed. Gas used: ${gasUsed}`;
		// 	} catch (error) {
		// 		console.error(error);
		// 		document.getElementById('status').innerText = 'Failed to execute scheduled transfer: ' + error.message;
		// 	}
		// }


		async function cancelScheduledTransfer() {
			const index = document.getElementById('cancelTransferIndex').value;
			const accounts = await web3.eth.getAccounts();
			try {
				const result = await contract.methods.cancelScheduledTransfer(index).send({ from: accounts[0] });
				console.log('Transaction result:', result);
				document.getElementById('status').innerText = 'Scheduled transfer cancelled successfully';
				// Refresh the scheduled transfers display
				await getAllScheduledTransfers();
			} catch (error) {
				console.error('Error details:', error);
				document.getElementById('status').innerText = 'Failed to cancel scheduled transfer: ' + error.message;
			}
		}

		// async function getScheduledTransfers() {
		// 	const user = document.getElementById('scheduledTransfersUser').value;
		// 	try {
		// 		const [scheduledTransfers, remainingTimes, indices] = await contract.methods.getScheduledTransfers(user).call();
		// 		const formattedTransfers = scheduledTransfers.map((transfer, index) => ({
		// 			index: indices[index],
		// 			sender: transfer.sender,
		// 			receiver: transfer.receiver,
		// 			amount: web3.utils.fromWei(transfer.amount, 'ether'),
		// 			unlockTime: new Date(transfer.unlockTime * 1000).toLocaleString(),
		// 			active: transfer.active,
		// 			remainingTime: remainingTimes[index]
		// 		}));

		// 		document.getElementById('status').innerHTML = '<h3>Scheduled Transfers:</h3>' +
		// 			formattedTransfers.map(t => `
		//         <p>
		//             Index: ${t.index}<br>
		//             From: ${t.sender}<br>
		//             To: ${t.receiver}<br>
		//             Amount: ${t.amount} ETH<br>
		//             Unlock Time: ${t.unlockTime}<br>
		//             Active: ${t.active}<br>
		//             Remaining Time: ${formatRemainingTime(t.remainingTime)}
		//         </p>
		//     `).join('<hr>');
		// 	} catch (error) {
		// 		console.error(error);
		// 		document.getElementById('status').innerText = 'Failed to get scheduled transfers';
		// 	}
		// }

		// async function getPendingScheduledTransfers() {
		// 	const user = document.getElementById('pendingTransfersUser').value;
		// 	try {
		// 		const [pendingTransfers, remainingTimes] = await contract.methods.getPendingScheduledTransfers(user).call();
		// 		const formattedTransfers = pendingTransfers.map((transfer, index) => ({
		// 			sender: transfer.sender,
		// 			receiver: transfer.receiver,
		// 			amount: web3.utils.fromWei(transfer.amount, 'ether'),
		// 			unlockTime: new Date(transfer.unlockTime * 1000).toLocaleString(),
		// 			remainingTime: remainingTimes[index]
		// 		}));

		// 		document.getElementById('status').innerHTML = '<h3>Pending Scheduled Transfers:</h3>' +
		// 			formattedTransfers.map(t => `
		//         <p>
		//             From: ${t.sender}<br>
		//             To: ${t.receiver}<br>
		//             Amount: ${t.amount} ETH<br>
		//             Unlock Time: ${t.unlockTime}<br>
		//             Remaining Time: ${formatRemainingTime(t.remainingTime)}
		//         </p>
		//     `).join('<hr>');
		// 	} catch (error) {
		// 		console.error(error);
		// 		document.getElementById('status').innerText = 'Failed to get pending scheduled transfers';
		// 	}
		// }

		async function scheduleAutoExecution() {
			const to = document.getElementById('autoScheduleTransferTo').value;
			const amount = document.getElementById('autoScheduleTransferAmount').value;
			const unlockTime = Math.floor(new Date(document.getElementById('autoScheduleTransferUnlockTime').value).getTime() / 1000);
			const accounts = await web3.eth.getAccounts();

			if (isNaN(amount) || parseFloat(amount) <= 0 || isNaN(unlockTime)) {
				document.getElementById('status').innerText = 'Invalid amount or unlock time';
				return;
			}

			try {
				await contract.methods.scheduleAutoExecution(to, web3.utils.toWei(amount, 'ether'), unlockTime).send({ from: accounts[0] });
				document.getElementById('status').innerText = 'Auto execution transfer scheduled';
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to schedule auto execution transfer: ' + error.message;
			}
		}

		async function executeAutoScheduledTransfers() {
			const accounts = await web3.eth.getAccounts();
			try {
				const receipt = await contract.methods.executeAutoScheduledTransfers().send({ from: accounts[0] });
				const gasUsed = receipt.gasUsed;
				document.getElementById('status').innerText = `Auto scheduled transfers executed. Gas used: ${gasUsed}`;
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to execute auto scheduled transfers: ' + error.message;
			}
		}

		// async function getAllScheduledTransfers() {
		// 	const accounts = await web3.eth.getAccounts();
		// 	try {
		// 		const result = await contract.methods.getAllScheduledTransfers().call({ from: accounts[0] });
		// 		const { receivers, amounts, unlockTimes, activeStatuses } = result;

		// 		let html = '<h3>All Scheduled Transfers:</h3>';
		// 		for (let i = 0; i < receivers.length; i++) {
		// 			const status = activeStatuses[i] ? 'Active' : 'Inactive';
		// 			const unlockDate = new Date(unlockTimes[i] * 1000);
		// 			const now = new Date();
		// 			const timeRemaining = unlockDate > now ? 
		// 				`(${formatTimeRemaining(unlockDate - now)} remaining)` : 
		// 				'(Ready for execution)';

		// 			html += `
        //         <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
        //             <strong>Transfer #${i + 1}</strong><br>
        //             Recipient: ${receivers[i]}<br>
        //             Amount: ${parseFloat(web3.utils.fromWei(amounts[i], 'ether')).toFixed(4)} ETH<br>
        //             Unlock Time: ${unlockDate.toLocaleString()} ${timeRemaining}<br>
        //             Status: ${status}
        //         </div>
        //     `;
		// 		}

		// 		document.getElementById('status').innerHTML = html;
		// 	} catch (error) {
		// 		console.error(error);
		// 		document.getElementById('status').innerText = 'Failed to get all scheduled transfers: ' + error.message;
		// 	}
		// }

		async function getAllScheduledTransfers() {
    const accounts = await web3.eth.getAccounts();
    try {
        const result = await contract.methods.getAllScheduledTransfers().call({ from: accounts[0] });
        const { receivers, amounts, unlockTimes, activeStatuses } = result;

        let html = `
            <h3>All Scheduled Transfers:</h3>
            <table border="1" cellpadding="5" cellspacing="0">
                <tr>
                    <th>Transfer #</th>
                    <th>Recipient</th>
                    <th>Amount (ETH)</th>
                    <th>Unlock Time</th>
                    <th>Status</th>
                </tr>
        `;

        for (let i = 0; i < receivers.length; i++) {
            const status = activeStatuses[i] ? 'Active' : 'Inactive';
            const unlockDate = new Date(unlockTimes[i] * 1000);
            const now = new Date();
            const timeRemaining = unlockDate > now ? 
                `(${formatTimeRemaining(unlockDate - now)} remaining)` : 
                '(Ready for execution)';

            html += `
                <tr>
                    <td>${i + 1}</td>
                    <td>${receivers[i]}</td>
                    <td>${parseFloat(web3.utils.fromWei(amounts[i], 'ether')).toFixed(4)}</td>
                    <td>${unlockDate.toLocaleString()} ${timeRemaining}</td>
                    <td>${status}</td>
                </tr>
            `;
        }

        html += '</table>';
        document.getElementById('scheduledTransfersContent').innerHTML = html;
        document.getElementById('scheduledTransfersModal').style.display = 'block';
    } catch (error) {
        console.error(error);
        showStatus('Failed to get all scheduled transfers: ' + error.message);
    }
}

		function formatTimeRemaining(ms) {
			const seconds = Math.floor(ms / 1000);
			const minutes = Math.floor(seconds / 60);
			const hours = Math.floor(minutes / 60);
			const days = Math.floor(hours / 24);

			if (days > 0) return `${days} day${days > 1 ? 's' : ''}`;
			if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''}`;
			if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''}`;
			return `${seconds} second${seconds !== 1 ? 's' : ''}`;
		}




		// async function getTransferHistory() {
		// 	const user1 = document.getElementById('transferHistoryUser1').value;
		// 	const user2 = document.getElementById('transferHistoryUser2').value;
		// 	try {
		// 		const history = await contract.methods.getTransferHistory(user1, user2).call();
		// 		const formattedHistory = history.map(transfer => ({
		// 			sender: transfer.sender,
		// 			receiver: transfer.receiver,
		// 			amount: web3.utils.fromWei(transfer.amount, 'ether'),
		// 			timestamp: new Date(transfer.timestamp * 1000).toLocaleString()
		// 		}));
		// 		document.getElementById('status').innerHTML = '<h3>Transfer History:</h3>' +
		// 			formattedHistory.map(t => `<p>From: ${t.sender}<br>To: ${t.receiver}<br>Amount: ${t.amount} ETH<br>Date: ${t.timestamp}</p>`).join('<hr>');
		// 	} catch (error) {
		// 		console.error(error);
		// 		document.getElementById('status').innerText = 'Failed to get transfer history';
		// 	}
		// }

		async function getTransferHistory() {
    const user1 = document.getElementById('transferHistoryUser1').value;
    const user2 = document.getElementById('transferHistoryUser2').value;

    try {
        const history = await contract.methods.getTransferHistory(user1, user2).call();
        const formattedHistory = history.map(transfer => ({
            sender: transfer.sender,
            receiver: transfer.receiver,
            amount: web3.utils.fromWei(transfer.amount, 'ether'),
            timestamp: new Date(transfer.timestamp * 1000).toLocaleString()
        }));

        let html = `
            <h3>Transfer History:</h3>
            <table border="1" cellpadding="5" cellspacing="0">
                <tr>
                    <th>From</th>
                    <th>To</th>
                    <th>Amount (ETH)</th>
                    <th>Date</th>
                </tr>
        `;
        html += formattedHistory.map(t => `
            <tr>
                <td>${t.sender}</td>
                <td>${t.receiver}</td>
                <td>${t.amount}</td>
                <td>${t.timestamp}</td>
            </tr>
        `).join('');
        html += '</table>';

        document.getElementById('transferHistoryContent').innerHTML = html;
        document.getElementById('transferHistoryModal').style.display = 'block';
    } catch (error) {
        console.error(error);
        showStatus('Failed to get transfer history: ' + error.message);
    }
}

		// async function getAllTransferHistory() {
		// 	const user = document.getElementById('allTransferHistoryUser').value;
		// 	try {
		// 		const history = await contract.methods.getAllTransferHistory(user).call();
		// 		const formattedHistory = history.map(transfer => ({
		// 			sender: transfer.sender,
		// 			receiver: transfer.receiver,
		// 			amount: web3.utils.fromWei(transfer.amount, 'ether'),
		// 			timestamp: new Date(transfer.timestamp * 1000).toLocaleString()
		// 		}));
		// 		document.getElementById('status').innerHTML = '<h3>All Transfer History:</h3>' +
		// 			formattedHistory.map(t => `<p>From: ${t.sender}<br>To: ${t.receiver}<br>Amount: ${t.amount} ETH<br>Date: ${t.timestamp}</p>`).join('<hr>');
		// 	} catch (error) {
		// 		console.error(error);
		// 		document.getElementById('status').innerText = 'Failed to get all transfer history';
		// 	}
		// }

	async function getAllTransferHistory() {
		const user = document.getElementById('allTransferHistoryUser').value;
		try {
			const history = await contract.methods.getAllTransferHistory(user).call();
			const formattedHistory = history.map(transfer => ({
				sender: transfer.sender,
				receiver: transfer.receiver,
				amount: web3.utils.fromWei(transfer.amount, 'ether'),
				timestamp: new Date(transfer.timestamp * 1000).toLocaleString()
			}));

			let html = `
				<h3>All Transfer History:</h3>
				<table border="1" cellpadding="5" cellspacing="0">
					<tr>
						<th>From</th>
						<th>To</th>
						<th>Amount (ETH)</th>
						<th>Date</th>
					</tr>
			`;
			html += formattedHistory.map(t => `
				<tr>
					<td>${t.sender}</td>
					<td>${t.receiver}</td>
					<td>${t.amount}</td>
					<td>${t.timestamp}</td>
				</tr>
			`).join('');
			html += '</table>';

			document.getElementById('allTransferHistoryContent').innerHTML = html;
			document.getElementById('allTransferHistoryModal').style.display = 'block';
		} catch (error) {
			console.error(error);
			showStatus('Failed to get all transfer history: ' + error.message);
		}
	}

		// async function getTransferDetails() {
		// 	const user = document.getElementById('transferDetailsUser').value;
		// 	const index = document.getElementById('transferDetailsIndex').value;
		// 	try {
		// 		const details = await contract.methods.getTransferDetails(user, index).call();
		// 		const formattedDetails = {
		// 			sender: details.sender,
		// 			receiver: details.receiver,
		// 			amount: web3.utils.fromWei(details.amount, 'ether'),
		// 			timestamp: new Date(details.timestamp * 1000).toLocaleString()
		// 		};
		// 		document.getElementById('status').innerHTML = '<h3>Transfer Details:</h3>' +
		// 			`<p>From: ${formattedDetails.sender}<br>To: ${formattedDetails.receiver}<br>Amount: ${formattedDetails.amount} ETH<br>Date: ${formattedDetails.timestamp}</p>`;
		// 	} catch (error) {
		// 		console.error(error);
		// 		document.getElementById('status').innerText = 'Failed to get transfer details';
		// 	}
		// }

		async function getTransferDetails() {
    const user = document.getElementById('transferDetailsUser').value;
    const index = document.getElementById('transferDetailsIndex').value;
    try {
        const details = await contract.methods.getTransferDetails(user, index).call();
        const formattedDetails = {
            sender: details.sender,
            receiver: details.receiver,
            amount: web3.utils.fromWei(details.amount, 'ether'),
            timestamp: new Date(details.timestamp * 1000).toLocaleString()
        };
        const html = `
            <h3>Transfer Details:</h3>
            <table border="1" cellpadding="5" cellspacing="0">
                <tr>
                    <th>Field</th>
                    <th>Value</th>
                </tr>
                <tr>
                    <td>From</td>
                    <td>${formattedDetails.sender}</td>
                </tr>
                <tr>
                    <td>To</td>
                    <td>${formattedDetails.receiver}</td>
                </tr>
                <tr>
                    <td>Amount</td>
                    <td>${formattedDetails.amount} ETH</td>
                </tr>
                <tr>
                    <td>Date</td>
                    <td>${formattedDetails.timestamp}</td>
                </tr>
            </table>
        `;
        document.getElementById('transferDetailsContent').innerHTML = html;
        document.getElementById('transferDetailsModal').style.display = 'block';
    } catch (error) {
        console.error(error);
        showStatus('Failed to get transfer details: ' + error.message);
    }
}

		// async function getTotalTransactionAmount() {
		// 	const sender = document.getElementById('totalAmountSender').value;
		// 	const receiver = document.getElementById('totalAmountReceiver').value;
		// 	try {
		// 		const amount = await contract.methods.getTotalTransactionAmount(sender, receiver).call();
		// 		const formattedAmount = web3.utils.fromWei(amount, 'ether');
		// 		document.getElementById('status').innerHTML = '<h3>Total Transaction Amount:</h3>' +
		// 			`<p>From: ${sender}<br>To: ${receiver}<br>Total Amount: ${formattedAmount} ETH</p>`;
		// 	} catch (error) {
		// 		console.error(error);
		// 		document.getElementById('status').innerText = 'Failed to get total transaction amount';
		// 	}
		// }

		async function getTotalTransactionAmount() {
    const sender = document.getElementById('totalAmountSender').value;
    const receiver = document.getElementById('totalAmountReceiver').value;
    try {
        const amount = await contract.methods.getTotalTransactionAmount(sender, receiver).call();
        const formattedAmount = web3.utils.fromWei(amount, 'ether');
        const html = `
            <h3>Total Transaction Amount:</h3>
            <table border="1" cellpadding="5" cellspacing="0">
                <tr>
                    <th>From</th>
                    <th>To</th>
                    <th>Total Amount (ETH)</th>
                </tr>
                <tr>
                    <td>${sender}</td>
                    <td>${receiver}</td>
                    <td>${formattedAmount}</td>
                </tr>
            </table>
        `;
        document.getElementById('totalAmountContent').innerHTML = html;
        document.getElementById('totalAmountModal').style.display = 'block';
    } catch (error) {
        console.error(error);
        showStatus('Failed to get total transaction amount: ' + error.message);
    }
}

				
		async function pauseContract() {
			const accounts = await web3.eth.getAccounts();
			try {
				await contract.methods.pause().send({ from: accounts[0] });
				document.getElementById('status').innerText = 'Contract paused successfully';
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to pause contract: ' + error.message;
			}
		}

		async function unpauseContract() {
			const accounts = await web3.eth.getAccounts();
			try {
				await contract.methods.unpause().send({ from: accounts[0] });
				document.getElementById('status').innerText = 'Contract unpaused successfully';
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to unpause contract: ' + error.message;
			}
		}

	</script>
</body>

</html>